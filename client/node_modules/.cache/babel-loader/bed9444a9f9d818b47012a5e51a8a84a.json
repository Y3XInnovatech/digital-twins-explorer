{"ast":null,"code":"import { __assign, __decorate, __extends } from \"tslib\";\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport { Fabric } from '../../Fabric';\nimport { classNamesFunction, customizable, getDocument, setPortalAttribute, setVirtualParent, warnDeprecations } from '../../Utilities';\nimport { registerLayer, getDefaultTarget, unregisterLayer } from './Layer.notification';\nvar getClassNames = classNamesFunction();\nvar LayerBase = /** @class */function (_super) {\n  __extends(LayerBase, _super);\n  function LayerBase(props) {\n    var _this = _super.call(this, props) || this;\n    _this._rootRef = React.createRef();\n    _this._createLayerElement = function () {\n      var hostId = _this.props.hostId;\n      var doc = getDocument(_this._rootRef.current);\n      var host = _this._getHost();\n      if (!doc || !host) {\n        return;\n      }\n      // If one was already existing, remove.\n      _this._removeLayerElement();\n      var layerElement = doc.createElement('div');\n      var classNames = _this._getClassNames();\n      layerElement.className = classNames.root;\n      setPortalAttribute(layerElement);\n      setVirtualParent(layerElement, _this._rootRef.current);\n      _this.props.insertFirst ? host.insertBefore(layerElement, host.firstChild) : host.appendChild(layerElement);\n      _this.setState({\n        hostId: hostId,\n        layerElement: layerElement\n      }, function () {\n        // eslint-disable-next-line deprecation/deprecation\n        var _a = _this.props,\n          onLayerDidMount = _a.onLayerDidMount,\n          onLayerMounted = _a.onLayerMounted;\n        if (onLayerMounted) {\n          onLayerMounted();\n        }\n        if (onLayerDidMount) {\n          onLayerDidMount();\n        }\n      });\n    };\n    _this.state = {};\n    if (process.env.NODE_ENV !== 'production') {\n      warnDeprecations('Layer', props, {\n        onLayerMounted: 'onLayerDidMount'\n      });\n    }\n    return _this;\n  }\n  LayerBase.prototype.componentDidMount = function () {\n    var hostId = this.props.hostId;\n    this._createLayerElement();\n    if (hostId) {\n      registerLayer(hostId, this._createLayerElement);\n    }\n  };\n  LayerBase.prototype.render = function () {\n    var layerElement = this.state.layerElement;\n    var classNames = this._getClassNames();\n    var eventBubblingEnabled = this.props.eventBubblingEnabled;\n    return React.createElement(\"span\", {\n      className: \"ms-layer\",\n      ref: this._rootRef\n    }, layerElement && ReactDOM.createPortal(React.createElement(Fabric, __assign({}, !eventBubblingEnabled && _getFilteredEvents(), {\n      className: classNames.content\n    }), this.props.children), layerElement));\n  };\n  LayerBase.prototype.componentDidUpdate = function () {\n    if (this.props.hostId !== this.state.hostId) {\n      this._createLayerElement();\n    }\n  };\n  LayerBase.prototype.componentWillUnmount = function () {\n    var hostId = this.props.hostId;\n    this._removeLayerElement();\n    if (hostId) {\n      unregisterLayer(hostId, this._createLayerElement);\n    }\n  };\n  LayerBase.prototype._removeLayerElement = function () {\n    var onLayerWillUnmount = this.props.onLayerWillUnmount;\n    var layerElement = this.state.layerElement;\n    if (layerElement) {\n      setVirtualParent(layerElement, null);\n    }\n    if (onLayerWillUnmount) {\n      onLayerWillUnmount();\n    }\n    if (layerElement && layerElement.parentNode) {\n      var parentNode = layerElement.parentNode;\n      if (parentNode) {\n        parentNode.removeChild(layerElement);\n      }\n    }\n  };\n  LayerBase.prototype._getClassNames = function () {\n    var _a = this.props,\n      className = _a.className,\n      styles = _a.styles,\n      theme = _a.theme;\n    var classNames = getClassNames(styles, {\n      theme: theme,\n      className: className,\n      isNotHost: !this.props.hostId\n    });\n    return classNames;\n  };\n  LayerBase.prototype._getHost = function () {\n    var hostId = this.props.hostId;\n    var doc = getDocument(this._rootRef.current);\n    if (!doc) {\n      return undefined;\n    }\n    if (hostId) {\n      return doc.getElementById(hostId);\n    } else {\n      var defaultHostSelector = getDefaultTarget();\n      return defaultHostSelector ? doc.querySelector(defaultHostSelector) : doc.body;\n    }\n  };\n  LayerBase.defaultProps = {\n    onLayerDidMount: function () {\n      return undefined;\n    },\n    onLayerWillUnmount: function () {\n      return undefined;\n    }\n  };\n  LayerBase = __decorate([customizable('Layer', ['theme', 'hostId'])], LayerBase);\n  return LayerBase;\n}(React.Component);\nexport { LayerBase };\nvar _onFilterEvent = function (ev) {\n  // We should just be able to check ev.bubble here and only stop events that are bubbling up. However, even though\n  // mouseenter and mouseleave do NOT bubble up, they are showing up as bubbling. Therefore we stop events based on\n  // event name rather than ev.bubble.\n  if (ev.eventPhase === Event.BUBBLING_PHASE && ev.type !== 'mouseenter' && ev.type !== 'mouseleave' && ev.type !== 'touchstart' && ev.type !== 'touchend') {\n    ev.stopPropagation();\n  }\n};\nvar _filteredEventProps;\nfunction _getFilteredEvents() {\n  if (!_filteredEventProps) {\n    _filteredEventProps = {};\n    ['onClick', 'onContextMenu', 'onDoubleClick', 'onDrag', 'onDragEnd', 'onDragEnter', 'onDragExit', 'onDragLeave', 'onDragOver', 'onDragStart', 'onDrop', 'onMouseDown', 'onMouseEnter', 'onMouseLeave', 'onMouseMove', 'onMouseOver', 'onMouseOut', 'onMouseUp', 'onTouchMove', 'onTouchStart', 'onTouchCancel', 'onTouchEnd', 'onKeyDown', 'onKeyPress', 'onKeyUp', 'onFocus', 'onBlur', 'onChange', 'onInput', 'onInvalid', 'onSubmit'].forEach(function (name) {\n      return _filteredEventProps[name] = _onFilterEvent;\n    });\n  }\n  return _filteredEventProps;\n}","map":{"version":3,"sources":["components/Layer/Layer.base.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\n\nimport { Fabric } from '../../Fabric';\nimport { ILayerProps, ILayerStyleProps, ILayerStyles } from './Layer.types';\nimport {\n  classNamesFunction,\n  customizable,\n  getDocument,\n  setPortalAttribute,\n  setVirtualParent,\n  warnDeprecations,\n} from '../../Utilities';\nimport { registerLayer, getDefaultTarget, unregisterLayer } from './Layer.notification';\n\nexport type ILayerBaseState = {\n  hostId?: string;\n  layerElement?: HTMLElement;\n};\n\nconst getClassNames = classNamesFunction<ILayerStyleProps, ILayerStyles>();\n\n@customizable('Layer', ['theme', 'hostId'])\nexport class LayerBase extends React.Component<ILayerProps, ILayerBaseState> {\n  public static defaultProps: ILayerProps = {\n    onLayerDidMount: () => undefined,\n    onLayerWillUnmount: () => undefined,\n  };\n\n  private _rootRef = React.createRef<HTMLSpanElement>();\n\n  constructor(props: ILayerProps) {\n    super(props);\n\n    this.state = {};\n\n    if (process.env.NODE_ENV !== 'production') {\n      warnDeprecations('Layer', props, {\n        onLayerMounted: 'onLayerDidMount',\n      });\n    }\n  }\n\n  public componentDidMount(): void {\n    const { hostId } = this.props;\n\n    this._createLayerElement();\n\n    if (hostId) {\n      registerLayer(hostId, this._createLayerElement);\n    }\n  }\n\n  public render(): React.ReactNode {\n    const { layerElement } = this.state;\n    const classNames = this._getClassNames();\n    const { eventBubblingEnabled } = this.props;\n\n    return (\n      <span className=\"ms-layer\" ref={this._rootRef}>\n        {layerElement &&\n          ReactDOM.createPortal(\n            <Fabric {...(!eventBubblingEnabled && _getFilteredEvents())} className={classNames.content}>\n              {this.props.children}\n            </Fabric>,\n            layerElement,\n          )}\n      </span>\n    );\n  }\n\n  public componentDidUpdate(): void {\n    if (this.props.hostId !== this.state.hostId) {\n      this._createLayerElement();\n    }\n  }\n\n  public componentWillUnmount(): void {\n    const { hostId } = this.props;\n\n    this._removeLayerElement();\n    if (hostId) {\n      unregisterLayer(hostId, this._createLayerElement);\n    }\n  }\n\n  private _createLayerElement = () => {\n    const { hostId } = this.props;\n\n    const doc = getDocument(this._rootRef.current);\n    const host = this._getHost();\n\n    if (!doc || !host) {\n      return;\n    }\n\n    // If one was already existing, remove.\n    this._removeLayerElement();\n\n    const layerElement = doc.createElement('div');\n    const classNames = this._getClassNames();\n\n    layerElement.className = classNames.root!;\n    setPortalAttribute(layerElement);\n    setVirtualParent(layerElement, this._rootRef.current!);\n\n    this.props.insertFirst ? host.insertBefore(layerElement, host.firstChild) : host.appendChild(layerElement);\n\n    this.setState(\n      {\n        hostId,\n        layerElement,\n      },\n      () => {\n        // eslint-disable-next-line deprecation/deprecation\n        const { onLayerDidMount, onLayerMounted } = this.props;\n        if (onLayerMounted) {\n          onLayerMounted();\n        }\n\n        if (onLayerDidMount) {\n          onLayerDidMount();\n        }\n      },\n    );\n  };\n\n  private _removeLayerElement(): void {\n    const { onLayerWillUnmount } = this.props;\n    const { layerElement } = this.state;\n\n    if (layerElement) {\n      setVirtualParent(layerElement, null);\n    }\n\n    if (onLayerWillUnmount) {\n      onLayerWillUnmount();\n    }\n\n    if (layerElement && layerElement.parentNode) {\n      const parentNode = layerElement.parentNode;\n      if (parentNode) {\n        parentNode.removeChild(layerElement);\n      }\n    }\n  }\n\n  private _getClassNames() {\n    const { className, styles, theme } = this.props;\n    const classNames = getClassNames(styles!, {\n      theme: theme!,\n      className,\n      isNotHost: !this.props.hostId,\n    });\n\n    return classNames;\n  }\n\n  private _getHost(): Node | undefined {\n    const { hostId } = this.props;\n    const doc = getDocument(this._rootRef.current);\n    if (!doc) {\n      return undefined;\n    }\n\n    if (hostId) {\n      return doc.getElementById(hostId) as Node;\n    } else {\n      const defaultHostSelector = getDefaultTarget();\n      return defaultHostSelector ? (doc.querySelector(defaultHostSelector) as Node) : doc.body;\n    }\n  }\n}\n\nconst _onFilterEvent = (ev: React.SyntheticEvent<HTMLElement>): void => {\n  // We should just be able to check ev.bubble here and only stop events that are bubbling up. However, even though\n  // mouseenter and mouseleave do NOT bubble up, they are showing up as bubbling. Therefore we stop events based on\n  // event name rather than ev.bubble.\n  if (\n    ev.eventPhase === Event.BUBBLING_PHASE &&\n    ev.type !== 'mouseenter' &&\n    ev.type !== 'mouseleave' &&\n    ev.type !== 'touchstart' &&\n    ev.type !== 'touchend'\n  ) {\n    ev.stopPropagation();\n  }\n};\n\nlet _filteredEventProps: { [key: string]: (ev: React.SyntheticEvent<HTMLElement, Event>) => void };\n\nfunction _getFilteredEvents() {\n  if (!_filteredEventProps) {\n    _filteredEventProps = {} as any;\n\n    [\n      'onClick',\n      'onContextMenu',\n      'onDoubleClick',\n      'onDrag',\n      'onDragEnd',\n      'onDragEnter',\n      'onDragExit',\n      'onDragLeave',\n      'onDragOver',\n      'onDragStart',\n      'onDrop',\n      'onMouseDown',\n      'onMouseEnter',\n      'onMouseLeave',\n      'onMouseMove',\n      'onMouseOver',\n      'onMouseOut',\n      'onMouseUp',\n      'onTouchMove',\n      'onTouchStart',\n      'onTouchCancel',\n      'onTouchEnd',\n      'onKeyDown',\n      'onKeyPress',\n      'onKeyUp',\n      'onFocus',\n      'onBlur',\n      'onChange',\n      'onInput',\n      'onInvalid',\n      'onSubmit',\n    ].forEach(name => (_filteredEventProps[name] = _onFilterEvent));\n  }\n\n  return _filteredEventProps;\n}\n"],"sourceRoot":"../src/"},"metadata":{},"sourceType":"module"}